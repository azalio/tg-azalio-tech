üò† **–ê–≥–µ–Ω—Ç-–ª–∏–º–∏—Ç–µ—Ä ‚Äú—Å–ª–µ–ø–Ω–µ—Ç‚Äù –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö PV? –†–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞ —Ä–∞–∑–±–∏—Ä–∞–µ–º—Å—è —Å `mountPropagation` –≤ Kubernetes!**

–ù–µ–¥–∞–≤–Ω–æ –ø–∏—Å–∞–ª I/O-–ª–∏–º–∏—Ç–µ—Ä –¥–ª—è LVM-—Ç–æ–º–æ–≤: –∞–≥–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç –º–∞—É–Ω—Ç—ã –ø–æ–¥–æ–≤, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å `MAJOR:MINOR` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ `io.max`, –∏ –≤—Å—ë –æ–∫‚Ä¶ –ø–æ–∫–∞ –Ω–∞ —É–∑–µ–ª –Ω–µ –ø—Ä–∏–µ–¥–µ—Ç –Ω–æ–≤—ã–π Pod. –ï–≥–æ –º–∞—É–Ω—Ç–∞ –∞–≥–µ–Ω—Ç —É–∂–µ –Ω–µ –≤–∏–¥–∏—Ç. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–º–æ–≥–∞–µ—Ç, –Ω–æ —ç—Ç–æ –∂–µ –∫–æ—Å—Ç—ã–ª—å!

---

## –ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

* –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ —Å–≤–æ—ë–º *priv–∞te* mount-namespace ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ö–æ—Å—Ç–µ —Ç—É–¥–∞ –Ω–µ –ø—Ä–æ–ª–µ—Ç–∞—é—Ç.
* –í Kubernetes —ç—Ç–æ —Ä–∞–≤–Ω–æ `mountPropagation: None`.

---

## –ö–∞–∫ –ø–æ—á–∏–Ω–∏—Ç—å

–ü–∞—Ä–∞–º–µ—Ç—Ä `mountPropagation` —É `volumeMounts` –∏–º–µ–µ—Ç 3 —Ä–µ–∂–∏–º–∞:

* **None** - –ø–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (`rprivate`), –¥–µ—Ñ–æ–ª—Ç.  
* **HostToContainer** - –º–∞—É–Ω—Ç—ã –ª–µ—Ç—è—Ç *—Å —Ö–æ—Å—Ç–∞ ‚Üí –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä* (`rslave`). **–ù–∞–º –Ω—É–∂–µ–Ω –∏–º–µ–Ω–Ω–æ –æ–Ω.**  
* **Bidirectional** - –º–∞—É–Ω—Ç—ã —Ö–æ–¥—è—Ç –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã (`rshared`). –†–∞–±–æ—Ç–∞–µ—Ç *—Ç–æ–ª—å–∫–æ* –≤ `privileged`-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∏–Ω–∞—á–µ Pod –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç.

---

## –†–µ—Ü–µ–ø—Ç

```yaml
spec:
  containers:
  - name: my-agent
    image: my-agent-image
    volumeMounts:
    - name: kubelet-pods
      mountPath: /var/lib/kubelet/pods
      mountPropagation: HostToContainer
  volumes:
  - name: kubelet-pods
    hostPath:
      path: /var/lib/kubelet/pods
      type: Directory
```

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥–æ–µ *–Ω–æ–≤–æ–µ* bind-mount —Å–æ–±—ã—Ç–∏–µ –≤–Ω—É—Ç—Ä–∏ `/var/lib/kubelet/pods` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∏–¥–Ω–æ –∞–≥–µ–Ω—Ç—É - –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤.

---

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

1. Kubelet –≤–∏–¥–∏—Ç `HostToContainer` –∏ –ø–∏—à–µ—Ç –≤ CRI `PROPAGATION_HOST_TO_CONTAINER`.  
2. CRI-shim (containerd/CRI-O) –¥–µ–ª–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ `rslave`.  
3. –í—Å–µ –±—É–¥—É—â–∏–µ –º–∞—É–Ω—Ç—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ kubelet‚Äô–æ–º –Ω–∞ —Ö–æ—Å—Ç–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äú–ø—Ä–æ–ª–∏–≤–∞—é—Ç—Å—è‚Äù –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

### –ù–∞ –∑–∞–º–µ—Ç–∫—É

* `Bidirectional` –æ–ø–∞—Å–µ–Ω –≤ –º—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–ª–∏—Ç—å –º–∞—É–Ω—Ç—ã *–Ω–∞ —Ö–æ—Å—Ç*.  
* –í Kubernetes 1.10 –±—ã–ª–æ –∫—Ä–∞—Ç–∫–æ–µ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ [–¥–µ—Ñ–æ–ª—Ç–æ–º –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —Å—Ç–∞–ª](https://github.com/kubernetes/kubernetes/pull/62462) `HostToContainer`. –ï—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Ç–µ –¥—Ä–µ–≤–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ (—Ö–æ—Ç—è –±–æ—é—Å—å –≤–∞–º —É–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–∂–µ—Ç...).  
* Cilium —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç —Ç—Ä—é–∫ —á—Ç–æ–±—ã [—Å–ª–µ–¥–∏—Ç—å](https://github.com/cilium/cilium/blob/v1.17.3/install/kubernetes/cilium/templates/cilium-envoy/daemonset.yaml#L195) –∑–∞ bpf –º–∞–ø–∞–º–∏.

---

–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏  
‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: <https://kubernetes.io/docs/concepts/storage/volumes/#mount-propagation>  
‚Ä¢ CRI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: <https://github.com/kubernetes/cri-api/blob/release-1.33/pkg/apis/runtime/v1/api.proto#L226>  
‚Ä¢ man mount: <https://man7.org/linux/man-pages/man8/mount.8.html>

#kubernetes #k8s #mountPropagation #linux #devops #storage
