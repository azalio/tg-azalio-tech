---
title: "–û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ kube-apiserver, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º health checks"
date: 2025-04-13T00:00:00+03:00 # Using date from directory name
draft: true
tags: ["kubernetes", "k8s", "security", "authentication", "kube-apiserver", "devops", "infosec"]
description: "–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ API-—Å–µ—Ä–≤–µ—Ä—É Kubernetes, –æ—Ç–∫–ª—é—á–∏–≤ –µ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–≤ –¥–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º /livez, /readyz –∏ /healthz —Å –ø–æ–º–æ—â—å—é AuthenticationConfiguration."
---

–ü—Ä–∏–≤–µ—Ç! –ù–µ–¥–∞–≤–Ω–æ –∫–æ –º–Ω–µ –ø—Ä–∏—à–µ–ª –∫–æ–ª–ª–µ–≥–∞-–±–µ–∑–æ–ø–∞—Å–Ω–∏–∫ —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –≤–æ–ø—Ä–æ—Å–æ–º: –∫–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ API-—Å–µ—Ä–≤–µ—Ä—É Kubernetes, –Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ `/livez`, `/readyz` –∏ `/healthz`? ü§î –°—Ö–æ–¥—É –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –ø–æ–ª–µ–∑ –∫–æ–ø–∞—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –∏ KEP–∞—Ö.

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`--anonymous-auth=true`) –ª—é–±–æ–π –º–æ–∂–µ—Ç –¥–µ—Ä–Ω—É—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã health-—á–µ–∫–æ–≤ –∏ –Ω–µ —Ç–æ–ª—å–∫–æ health-—á–µ–∫–æ–≤:

```bash
curl -k https://<API_SERVER_IP>:6443/livez
# Output: ok
```

–≠—Ç–æ —É–¥–æ–±–Ω–æ, –Ω–æ —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏, –µ—Å–ª–∏ RBAC –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞–π–¥–µ—Ç—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç—å. –ë–µ–∑–æ–ø–∞—Å–Ω–∏–∫–∏ —Ç–∞–∫–æ–µ –Ω–µ –ª—é–±—è—Ç. üòü

–ö —Å—á–∞—Å—Ç—å—é, –≤ KEP-4633 —Å–æ–æ–±—â–µ—Å—Ç–≤–æ Kubernetes –ø—Ä–µ–¥–ª–æ–∂–∏–ª–æ —Ä–µ—à–µ–Ω–∏–µ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∫ –∫–∞–∫–∏–º –ø—É—Ç—è–º —Ä–∞–∑—Ä–µ—à–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø, –¥–∞–∂–µ –µ—Å–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –æ–Ω –≤—ã–∫–ª—é—á–µ–Ω.

–°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ —Ç–∞–∫:

–°–Ω–∞—á–∞–ª–∞ –≤—ã–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ `kube-apiserver`:

```yaml
# /etc/kubernetes/manifests/kube-apiserver.yaml
spec:
  containers:
  - command:
    - kube-apiserver
    # ... –¥—Ä—É–≥–∏–µ —Ñ–ª–∞–≥–∏ ...
    - --anonymous-auth=false # <--- –í—ã–∫–ª—é—á–∞–µ–º!
    - --authentication-config=/etc/kubernetes/auth-config.yaml # <--- –£–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
    volumeMounts: # <--- –ù–µ –∑–∞–±—ã–≤–∞–µ–º –ø—Ä–æ volumeMount
    - name: auth-config
      mountPath: /etc/kubernetes/auth-config.yaml
      readOnly: true
    # ... –¥—Ä—É–≥–∏–µ volumeMounts ...
  volumes: # <--- –ò –ø—Ä–æ volume
  - name: auth-config
    hostPath:
      path: /etc/kubernetes/auth-config.yaml
      type: File
  # ... –¥—Ä—É–≥–∏–µ volumes ...
```

–ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `/etc/kubernetes/auth-config.yaml` –Ω–∞ control plane –Ω–æ–¥–∞—Ö:

```yaml
# /etc/kubernetes/auth-config.yaml
apiVersion: apiserver.config.k8s.io/v1beta1
kind: AuthenticationConfiguration
anonymous:
  enabled: true # –í–∫–ª—é—á–∞–µ–º –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø *—Ç–æ–ª—å–∫–æ* –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
  conditions:
  - path: /livez
  - path: /readyz
  - path: /healthz
```

*(–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å `volume` –∏ `volumeMount`, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ `kube-apiserver` –≤—ã—à–µ, —á—Ç–æ–±—ã –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª)*

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ–º:
- –ó–∞–ø—Ä–æ—Å—ã –∫ `/livez`, `/readyz`, `/healthz` –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–∞–∫ `system:anonymous`.
- –ó–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º –ø—É—Ç—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/apis`) –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç `401 Unauthorized`.

–ö—Å—Ç–∞—Ç–∏, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å –∫–∞–∫ Alpha –≤ Kubernetes 1.31 –∏ —Å—Ç–∞–ª–∞ Beta –≤ 1.32.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–ø–∞—Ç—å —Å–ø–æ–∫–æ–π–Ω–µ–µ, –∑–Ω–∞—è, —á—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º! üëç

---

**–•–æ—Ç–∏—Ç–µ –≥–ª—É–±–∂–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ Kubernetes –∏ Cilium?**

–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ª–∏—à—å –æ–¥–∏–Ω –∞—Å–ø–µ–∫—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Kubernetes. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Å–≤–æ–∏—Ç—å Kubernetes –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –ø–æ–Ω–∏–º–∞—Ç—å –µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –Ω–∞—É—á–∏—Ç—å—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cilium –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ observability, –ø—Ä–∏–≥–ª–∞—à–∞—é –≤–∞—Å –Ω–∞ –º–æ–∏ –∫—É—Ä—Å—ã:

*   **[–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –ø–æ Kubernetes]**: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∞]
*   **[–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –ø–æ Cilium]**: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∞]

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –≤ –º–∏—Ä–µ –æ–±–ª–∞—á–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π!