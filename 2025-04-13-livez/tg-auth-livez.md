https://t.me/azalio_tech/48

üîí **–û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ kube-apiserver, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º health checks!**

–ü—Ä–∏–≤–µ—Ç! –ù–µ–¥–∞–≤–Ω–æ –∫–æ –º–Ω–µ –ø—Ä–∏—à–µ–ª –∫–æ–ª–ª–µ–≥–∞-–±–µ–∑–æ–ø–∞—Å–Ω–∏–∫ (–î–∏–º–∞ –ø—Ä–∏–≤–µ—Ç!) —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –≤–æ–ø—Ä–æ—Å–æ–º: –∫–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ API-—Å–µ—Ä–≤–µ—Ä—É Kubernetes, –Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ `/livez`, `/readyz` –∏ `/healthz`? ü§î –°—Ö–æ–¥—É –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –ø–æ–ª–µ–∑ –∫–æ–ø–∞—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –∏ KEP–∞—Ö.

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`--anonymous-auth=true`) –ª—é–±–æ–π –º–æ–∂–µ—Ç –¥–µ—Ä–Ω—É—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã health-—á–µ–∫–æ–≤ –∏ –Ω–µ —Ç–æ–ª—å–∫–æ health-—á–µ–∫–æ–≤:
```bash
curl -k https://<API_SERVER_IP>:6443/livez
# Output: ok
```
–≠—Ç–æ —É–¥–æ–±–Ω–æ, –Ω–æ —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏, –µ—Å–ª–∏ RBAC –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞–π–¥–µ—Ç—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç—å. –ë–µ–∑–æ–ø–∞—Å–Ω–∏–∫–∏ —Ç–∞–∫–æ–µ –Ω–µ –ª—é–±—è—Ç. üòü

–ö —Å—á–∞—Å—Ç—å—é, –≤ KEP-4633 —Å–æ–æ–±—â–µ—Å—Ç–≤–æ Kubernetes –ø—Ä–µ–¥–ª–æ–∂–∏–ª–æ —Ä–µ—à–µ–Ω–∏–µ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∫ –∫–∞–∫–∏–º –ø—É—Ç—è–º —Ä–∞–∑—Ä–µ—à–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø, –¥–∞–∂–µ –µ—Å–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –æ–Ω –≤—ã–∫–ª—é—á–µ–Ω.

–°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ —Ç–∞–∫:

–°–Ω–∞—á–∞–ª–∞ –≤—ã–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ `kube-apiserver`:
    ```yaml
    spec:
      containers:
      - command:
        - kube-apiserver
        # ... –¥—Ä—É–≥–∏–µ —Ñ–ª–∞–≥–∏ ...
        - --anonymous-auth=false # <--- –í—ã–∫–ª—é—á–∞–µ–º!
        - --authentication-config=/etc/kubernetes/auth-config.yaml # <--- –£–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
    ```

–ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `/etc/kubernetes/auth-config.yaml` –Ω–∞ control plane –Ω–æ–¥–∞—Ö –∏ –º–æ–Ω—Ç–∏—Ä—É–µ–º –µ–≥–æ –≤ –ø–æ–¥ `kube-apiserver`:
    ```yaml
    # /etc/kubernetes/auth-config.yaml
    apiVersion: apiserver.config.k8s.io/v1beta1
    kind: AuthenticationConfiguration
    anonymous:
      enabled: true # –í–∫–ª—é—á–∞–µ–º –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø *—Ç–æ–ª—å–∫–æ* –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
      conditions:
      - path: /livez
      - path: /readyz
      - path: /healthz
    ```
    *(–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å `volume` –∏ `volumeMount` –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç `kube-apiserver` –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞)*

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ–º:
- –ó–∞–ø—Ä–æ—Å—ã –∫ `/livez`, `/readyz`, `/healthz` –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–∞–∫ `system:anonymous`.
- –ó–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º –ø—É—Ç—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/apis`) –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç `401 Unauthorized`.

–ö—Å—Ç–∞—Ç–∏, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å –∫–∞–∫ Alpha –≤ Kubernetes 1.31 –∏ —Å—Ç–∞–ª–∞ Beta –≤ 1.32.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–ø–∞—Ç—å —Å–ø–æ–∫–æ–π–Ω–µ–µ, –∑–Ω–∞—è, —á—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º! üëç

#kubernetes #k8s #security #authentication #kubeadm #api #devops #infosec